<div ng-controller="Editor_SchemaCtrl"
     class="panel"
     ng-class="sharableType.class ? 'panel-' + sharableType.class :  'panel-default'">
    <div class="panel-heading">
        <h3 class="panel-title">Schema Editor</h3>
    </div>
    <div class="panel-body ng-cloak">

    <fieldset class="ng-cloak" ng-disabled="!editMode">

        <form-field name="Name" horizontal="formHorizontal">
            <input type="text" id="schemaName" ng-model="sharable.name" required restrict-input="findSpacesRegExp">
        </form-field>

        <form-field name="SuperClass" horizontal="formHorizontal">
            <select id="superClass" ng-model="sharable.superClass" ng-options="schema.id as schema.name for schema in schemas">
                <option value="">-</option>
            </select>
        </form-field>

        <form-field name="Description" horizontal="formHorizontal">
            <textarea id="schemaDesc" class="input-lg" ng-model="sharable.description" style="width: 100%; height: 3em"></textarea>
        </form-field>


        <div class="form-group">
            <label class="control-label col-sm-3">Methods</label>
            <div class="col-sm-9">
                <div class="input-group">
                    <input type="text" class="form-control" ng-model="newMethodObj" ng-init="newMethodObj = newMethod()" typeahead="opt.id as opt.name for opt in clothoFunctions | filter:$viewValue" typeahead-min-length="0">
                        <span class="input-group-btn">
                            <button class="btn pull-right" type="button" ng-click="addNewMethod()" ng-disabled="!newMethodObj"><i class="glyphicon glyphicon-plus"></i></button>
                        </span>
                </div>

                <div class="input-group" ng-repeat="method in sharable.methods">
                    <input type="text" class="form-control" ng-model="method">
                        <span class="input-group-btn">
                            <button class="btn btn-default" ng-click="sharable.methods.splice($index, 1)">
                                <i class="glyphicon glyphicon-remove"></i>
                            </button>
                        </span>
                </div>
            </div>
        </div>

        <div class="panel panel-default">
            <div class="panel-heading">
                <span class="panel-title">Fields</span>

                <div class="btn-group pull-right" style="margin-top: -4px;">
                    <button class="btn btn-default btn-sm" ng-click="addField()"><i class="glyphicon glyphicon-plus"></i> Add Field</button>
                </div>
            </div>
            <div class="panel-body">
                <div class="form-group" ng-repeat="field in superClassObj.fields" style="margin: 0 0 5px;">
                    <label class="control-label col-sm-4">{{field.name}}</label>
                    <div class="col-sm-8">
                        <p class="form-control-static">{{field.type}}</p>
                    </div>
                </div>
                <div ng-show="!superClassObj.fields.length">
                    <p style="text-align: center">No inherited Fields</p>
                </div>
            </div>

            <div class="list-group">
                <div class="list-group-item clearfix" ng-repeat="field in sharable.fields">

                    <div class="row">
                        <div class="col-sm-3">
                            <select ng-model="field.type" class="form-control" ng-options="t.name as t.name group by t.category for t in paramTypes" ng-change="parseField(field)" required>
                                <option value="" disabled>Type</option>
                            </select>
                        </div>

                        <div class="col-sm-6">
                            <input type="text" ng-model="field.name" class="form-control" placeholder="Field Name (no spaces)" restrict-input="findSpacesRegExp" required>
                        </div>

                        <div class="col-sm-3">
                            <select ng-model="field.access" ng-options="t.value as t.name for t in accessTypes" class="form-control">
                                <option value="" disabled>Access</option>
                            </select>
                        </div>
                    </div>

                    <input class="form-control" type="text" ng-model="field.description" placeholder="Field Description">

                    <div class="row">
                        <div class="col-sm-9">
                            <input ng-if="!field.reference" class="form-control" type="text" ng-model="field.example" placeholder="Field Example">
                            <input ng-if="field.reference" class="form-control" type="text" ng-model="field.example"placeholder="Field Example" typeahead="opt for opt in querySchemaWrapper(field.type) | filter:$viewValue" typeahead-min-length="0" />
                        </div>
                        <div class="col-sm-3">
                            <button class="btn btn-default" type="button" ng-click="addConstraint($index)"><i class="glyphicon glyphicon-plus"></i>Add Constraint</button>
                        </div>
                    </div>

                    <div class="row" ng-show="!!field.constraints">
                        <div class="col-sm-12">
                            <div ng-repeat="constraint in field.constraints" class="row">
                                <div class="col-sm-4">
                                    <select ng-model="constraint.type" class="form-control" ng-options="t.value as t.name for t in constraintTypes"></select>
                                </div>
                                <div class="col-sm-8">
                                    <input class="form-control" type="text" ng-model="constraint.value" placeholder="Constraint Value">
                                </div>

                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </fieldset>

    <button ng-show="editMode && !showJsonEditor" type="button" class="btn btn-default" ng-click="toggleJsonEdit()">Edit Json</button>
    <div ng-show="showJsonEditor">
        <hr>
        <form-field name="Edit JSON directly">
            <textarea json-edit="$parent.$parent.sharable" rows="12"></textarea>
        </form-field>
    </div>

    </div>
    <div class="panel-footer" ng-include="_formActions"></div>
</div>