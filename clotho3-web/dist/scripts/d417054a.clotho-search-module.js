angular.module("clotho.search",["clotho.core"]),angular.module("clotho.search").service("CommandBar",["Clotho","ClientAPI","$timeout","$q",function(a,b,c,d){function e(a){g.unread=g.unread&&!i.log?g.unread+1:1,g.entries.unshift(a),i.show("logSnippet"),g.startLogTimeout()}var f={dateFilter:"mediumTime",timeFilter:"timestamp"},g={},h={};h.autocompletions=[],h.autoDetail={},h.detailTemplate={},h.detailModel={},h.detailUUID=-1,g.entries=[{text:"Welcome to Clotho!",from:"server","class":"success",timestamp:Date.now()}];var i={};i.query="",i.queryHistory=[],i.autocomplete=!1,i.autocompleteDetail=!1,i.autocompleteDetailInfo=!1,i.help=!1,i.log=!1,i.logSnippet=!1,i.show=function(a){i[a]||(i[a]=!0)},i.hide=function(a){i[a]&&(i[a]=!1)},i.toggle=function(a){i[a]=!i[a]},i.genLogPos=function(){var a=document.getElementById("searchbar_logbutton");i.logpos={left:a.offsetLeft+a.scrollWidth/2-200+"px",top:a.offsetTop+a.scrollHeight+"px"}},i.genAutocompletePos=function(){var a=document.getElementById("searchBarInput");i.autocompletePos={left:a.offsetLeft+"px",top:a.offsetTop+a.scrollHeight+6+"px"}},i.detail=function(b){"undefined"!=typeof b&&(b!=h.detailUUID&&(i.hide("autocompleteDetailInfo"),h.detailUUID=b),a.autocompleteDetail(h.detailUUID).then(function(a){h.autoDetail=a,i.show("autocompleteDetail")}))},i.undetail=function(){i.hide("autocompleteDetail"),i.hide("autocompleteDetailInfo"),h.detailModel={}},i.detailInfo=function(a,b){switch(a){case"command":h.detailTemplate="views/_command/detail-command.html";break;case"author":h.detailTemplate="views/_command/detail-author.html"}h.detailModel=h.autoDetail.sharables[b],"author"==a&&(h.detailModel=h.detailModel.author),i.show("autocompleteDetailInfo")},g.timeout=null,g.startLogTimeout=function(){g.cancelLogTimeout(),g.timeout=c(function(){i.hide("logSnippet")},1e4)},g.cancelLogTimeout=function(){c.cancel(g.timeout)};var j=function(a){console.log("this would be run: "+a),i.hide("autocomplete"),i.undetail()},k=function(c){if(c||(c=i.query),c){var e={"class":"info",from:"client",text:c,timestamp:Date.now()};return i.queryHistory.push(e),i.undetail(),b.say(e),a.submit(c).then(function(a){i.query="",!!a&&b.say({text:a})})}return d.when(!1)};return a.listen("activityLog",function(a){e(a)},"searchbar"),{options:f,display:i,log:g,setQuery:function(a,b){"undefined"!=typeof b&&b.preventDefault(),a&&(i.query=a.value?a.value:a.text)},autocomplete:h,submit:k,execute:j}}]),angular.module("clotho.search").directive("clothoCommandBar",["Clotho","CommandBar","$location","$window",function(a,b,c,d){return{restrict:"A",replace:!0,templateUrl:"views/_command/commandbar.html",controller:["$scope","$element","$attrs",function(e){e.options=b.options,e.log=b.log,e.autocomplete=b.autocomplete,e.display=b.display,e.setQuery=b.setQuery,e.submit=b.submit,e.execute=b.execute,e.$watch("display.query",function(){}),e.prevSubmittedIndex=!1,e.selectAutoNext=function(a){a.preventDefault();var c=e.display.queryHistory.length-1;e.prevSubmittedIndex=e.prevSubmittedIndex?e.prevSubmittedIndex<c?e.prevSubmittedIndex+1:c:0,console.log(e.prevSubmittedIndex),b.setQuery(e.display.queryHistory[e.prevSubmittedIndex])},e.selectAutoPrev=function(a){a.preventDefault();var c=e.display.queryHistory.length-1;e.prevSubmittedIndex=e.prevSubmittedIndex?e.prevSubmittedIndex>0?c:0:e.display.queryHistory.length?c:0,console.log(e.prevSubmittedIndex),b.setQuery(e.display.queryHistory[e.prevSubmittedIndex])},e.fullPageLog=function(){c.path("/terminal"),e.display.hide("log")},e.pathIsTerminal=function(){var a=/^\/terminal.*$/;return a.test(c.path())},e.newPage=function(){d.open(d.location.origin,"_blank")},e.newWorkspace=function(){d.open(d.location.origin,"_blank")},e.showMeHow=function(){a.query({name:"Learning Clotho"}).then(function(a){c.path("/trails/"+a[0].id)})},e.goHome=function(){c.path("/")},e.aboutClotho=function(){c.path("/about")},e.teamClotho=function(){c.path("/team")},e.toggleTooltips=function(){console.log("tooltips")}}],link:function(){}}}]),angular.module("clotho.search").controller("TerminalCtrl",["$scope","CommandBar",function(a,b){a.log=b.log}]),angular.module("clotho.search").directive("commandBarAutocomplete",["Clotho","CommandBar","$location","$window",function(){return{restrict:"A",templateUrl:"views/_command/autocomplete.html"}}]),angular.module("clotho.search").directive("logEntries",function(){return{restrict:"A",templateUrl:"../views/_command/logEntries.html",scope:{entries:"=logEntries"}}});