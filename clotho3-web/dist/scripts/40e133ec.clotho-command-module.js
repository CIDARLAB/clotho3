angular.module("clotho.commandbar",["clotho.core"]),angular.module("clotho.commandbar").service("CommandBar",["Clotho","ClientAPI","$timeout","$q","$document",function(a,b,c,d,e){function f(a){i.unread=i.unread&&!k.log?i.unread+1:1,i.entries.unshift(a),k.show("logSnippet"),i.startLogTimeout()}var g={dateFilter:"mediumTime",timeFilter:"timestamp"},h={};h.commandBarElement=angular.element(e[0].getElementById("clothoCommandBar")),h.commandBarInput=angular.element(e[0].getElementById("clothoCommandBarInput")),h.commandBarLogButton=angular.element(e[0].getElementById("clothoCommandBarLogButton"));var i={},j={};j.autocompletions=[],j.autoDetail={},j.detailTemplate={},j.detailModel={},j.detailUUID=-1,i.entries=[{text:"Welcome to Clotho!",from:"server","class":"success",timestamp:Date.now()}];var k={};k.query="",k.queryHistory=[],k.autocomplete=!1,k.autocompleteDetail=!1,k.autocompleteDetailInfo=!1,k.help=!1,k.log=!1,k.logSnippet=!1,k.show=function(a){k[a]||(k[a]=!0)},k.hide=function(a){k[a]&&(k[a]=!1)},k.toggle=function(a){k[a]=!k[a]},k.genLogPos=function(){var a=h.commandBarLogButton;k.logpos={left:a.offsetLeft+a.scrollWidth/2-200+"px",top:a.offsetTop+a.scrollHeight+"px"}},k.genAutocompletePos=function(){var a=h.commandBarInput;k.autocompletePos={left:a.offsetLeft+"px",top:a.offsetTop+a.scrollHeight+6+"px"}},k.detail=function(b){"undefined"!=typeof b&&(b!=j.detailUUID&&(k.hide("autocompleteDetailInfo"),j.detailUUID=b),a.autocompleteDetail(j.detailUUID).then(function(a){j.autoDetail=a,k.show("autocompleteDetail")}))},k.undetail=function(){k.hide("autocompleteDetail"),k.hide("autocompleteDetailInfo"),j.detailModel={}},k.detailInfo=function(a,b){switch(a){case"command":j.detailTemplate="views/_command/detail-command.html";break;case"author":j.detailTemplate="views/_command/detail-author.html"}j.detailModel=j.autoDetail.sharables[b],"author"==a&&(j.detailModel=j.detailModel.author),k.show("autocompleteDetailInfo")},i.timeout=null,i.startLogTimeout=function(){i.cancelLogTimeout(),i.timeout=c(function(){k.hide("logSnippet")},1e4)},i.cancelLogTimeout=function(){c.cancel(i.timeout)};var l=function(a){console.log("this would be run: "+a),k.hide("autocomplete"),k.undetail()},m=function(c){if(c||(c=k.query),c){var e={"class":"info",from:"client",text:c,timestamp:Date.now()};return k.queryHistory.push(e),k.undetail(),b.say(e),a.submit(c).then(function(a){k.query="",!!a&&b.say({text:a})})}return d.when(!1)};return a.listen("activityLog",function(a){f(a)},"searchbar"),{options:g,display:k,log:i,setQuery:function(a,b){"undefined"!=typeof b&&b.preventDefault(),a&&(k.query=a.value?a.value:a.text)},autocomplete:j,submit:m,execute:l,getCommandBarElement:function(){return h.commandBarElement},getCommandBarInput:function(){return h.commandBarInput},focusInput:function(){h.commandBarInput.focus()}}}]),angular.module("clotho.commandbar").directive("clothoCommandBar",["Clotho","CommandBar","$location","$window",function(a,b,c,d){return{restrict:"A",replace:!0,templateUrl:"views/_command/commandbar.html",controller:["$scope","$element","$attrs",function(a){a.options=b.options,a.log=b.log,a.autocomplete=b.autocomplete,a.display=b.display,a.setQuery=b.setQuery,a.submit=b.submit,a.execute=b.execute,a.$watch("display.query",function(){}),a.prevSubmittedIndex=!1,a.selectAutoNext=function(c){c.preventDefault();var d=a.display.queryHistory.length-1;a.prevSubmittedIndex=a.prevSubmittedIndex?a.prevSubmittedIndex<d?a.prevSubmittedIndex+1:d:0,console.log(a.prevSubmittedIndex),b.setQuery(a.display.queryHistory[a.prevSubmittedIndex])},a.selectAutoPrev=function(c){c.preventDefault();var d=a.display.queryHistory.length-1;a.prevSubmittedIndex=a.prevSubmittedIndex?a.prevSubmittedIndex>0?d:0:a.display.queryHistory.length?d:0,console.log(a.prevSubmittedIndex),b.setQuery(a.display.queryHistory[a.prevSubmittedIndex])},a.fullPageLog=function(){c.path("/terminal"),a.display.hide("log")},a.pathIsTerminal=function(){var a=/^\/terminal.*$/;return a.test(c.path())}}],link:function(b){b.newPage=function(){d.open(d.location.origin,"_blank")},b.newWorkspace=function(){d.open(d.location.origin,"_blank")},b.showMeHow=function(){a.query({name:"Learning Clotho"}).then(function(a){c.path("/trails/"+a[0].id)})},b.goHome=function(){c.path("/")},b.aboutClotho=function(){c.path("/about")},b.teamClotho=function(){c.path("/team")},b.toggleTooltips=function(){console.log("tooltips")}}}}]),angular.module("clotho.commandbar").controller("TerminalCtrl",["$scope","CommandBar",function(a,b){a.log=b.log}]),angular.module("clotho.commandbar").directive("commandBarAutocomplete",["Clotho","CommandBar","$location","$window",function(){return{restrict:"A",templateUrl:"views/_command/autocomplete.html"}}]),angular.module("clotho.commandbar").directive("logEntries",function(){return{restrict:"A",templateUrl:"../views/_command/logEntries.html",scope:{entries:"=logEntries"}}});