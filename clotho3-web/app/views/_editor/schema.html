<div ng-controller="Editor_SchemaCtrl">

    <legend>Schema Editor</legend>
    <fieldset class="ng-cloak" ng-disabled="!editMode">

        <form-field name="Name">
            <input type="text" id="schemaName" ng-model="sharable.name" required restrict-input="findSpacesRegExp">
        </form-field>

        <form-field name="SuperClass">
            <select id="superClass" ng-model="sharable.superClass" ng-options="schema.id as schema.name for schema in schemas">
                <option value="">-</option>
            </select>
        </form-field>

        <form-field name="Description">
            <textarea type="text" id="schemaDesc" class="input-lg" ng-model="sharable.description" style="width: 100%; height: 3em"></textarea>
        </form-field>


        <h4>
            Methods
        </h4>
        <div class="input-group">
            <input type="text" id="newMethodText" ng-model="newMethodObj" ng-init="newMethodObj = newMethod()" ng-disabled="!editMode" typeahead="opt.id as opt.name for opt in clothoFunctions | filter:$viewValue" typeahead-min-length="0"/>
            <button class="btn pull-right" type="button" ng-click="addNewMethod()"
                    ng-disabled="!editMode || !newMethodObj"><i class="glyphicon glyphicon-plus"></i></button>
        </div>

        <ul class="list-unstyled list-inline">
            <li ng-repeat="method in sharable.methods">
                <a ng-click="sharable.methods.splice($index,1)">{{ determineMethodName(method) }}</a>
            </li>
        </ul>

        <h3>
            Fields
        </h3>

        <div ng-if="sharable.superClass">
            <h4>Inherited Fields</h4>

            <div ng-repeat="field in superClassObj.fields">
                <div class="row">
                    <input type="text" ng-model="field.type" class="col-xs-3" disabled />
                    <input class="col-xs-6" type="text" ng-model="field.name" disabled />
                    <input type="text" ng-model="field.access" class="col-xs-3" disabled />
                </div>
            </div>

            <h4>This Object's fields</h4>

        </div>

        <div ng-repeat="field in sharable.fields">
            <div class="row">
                <select ng-model="field.type" class="col-xs-3" ng-disabled="!editMode" ng-options="t.name as t.name group by t.category for t in paramTypes" ng-change="parseField(field)" required>
                    <option value="" disabled>Type</option>
                </select>
                <input class="col-xs-6" type="text" ng-model="field.name" ng-disabled="!editMode" placeholder="Field Name (no spaces)" restrict-input="findSpacesRegExp" required>
                <select ng-model="field.access" class="col-xs-3" ng-disabled="!editMode" ng-options="t.value as t.name for t in accessTypes">
                    <option value="" disabled>Access</option>
                </select>
            </div>
            <div class="row">
                <div class="col-xs-6 pull-left">
                    <input class="col-xs-12" type="text" ng-model="field.description" ng-disabled="!editMode" placeholder="Field Description">
                    <input ng-if="!field.reference" class="col-xs-12" type="text" ng-model="field.example" ng-disabled="!editMode" placeholder="Field Example">
                    <input ng-if="field.reference" class="col-xs-12" type="text" ng-model="field.example" ng-disabled="!editMode" placeholder="Field Example" typeahead="opt for opt in querySchemaWrapper(field.type) | filter:$viewValue" typeahead-min-length="0" />
                </div>
                <div class="col-xs-6 pull-right">
                    <div ng-show="!!field.constraints">
                        <h5>
                            Constraints
                            <button class="btn pull-right" type="button" ng-click="addConstraint($index)" ng-disabled="!editMode"><i class="glyphicon glyphicon-plus"></i></button>
                        </h5>
                        <div ng-repeat="constraint in field.constraints" class="row">
                            <select ng-model="constraint.type" class="col-xs-4" ng-disabled="!editMode" ng-options="t.value as t.name for t in constraintTypes"></select>
                            <input class="col-xs-8" type="text" ng-model="constraint.value" ng-disabled="!editMode" placeholder="Constraint Value">
                        </div>
                    </div>
                    <div ng-hide="!!field.constraints">
                        <button class="btn pull-right" type="button" ng-click="addConstraint($index)" ng-disabled="!editMode"><i class="glyphicon glyphicon-plus"></i>Add Constraint</button>
                    </div>

                </div>
            </div>
            <hr />
        </div>

        <button class="btn" type="button" ng-click="addField()" ng-disabled="!editMode"><i class="glyphicon glyphicon-plus"></i> New Field</button>

    </fieldset>

    <div ng-include="_formActions"></div>

    {{ sharable | json }}

</div>